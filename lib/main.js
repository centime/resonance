// Generated by CoffeeScript 1.6.2
(function() {
  var URL, data, irc, panel, resonanceOptions, sha1, storage, tabs;

  data = require("sdk/self").data;

  URL = require('sdk/url').URL;

  tabs = require('sdk/tabs');

  data = require("sdk/self").data;

  storage = require("sdk/simple-storage").storage;

  sha1 = require('./sha1.js').sha1;

  irc = require('./_irc.js');

  resonanceOptions = {
    'activated': true,
    'joinByDefault': true,
    'displayByDefault': true,
    'joinForDomains': [],
    'displayForDomains': [],
    'nick': 'zob_du_test'
  };

  panel = require("sdk/panel").Panel({
    'width': 800,
    'height': 200,
    'contentURL': data.url("panel.html"),
    'contentScriptFile': [data.url("lib/angular.min.js"), data.url("lib/jquery.js"), data.url("panel_controllers/panel.js")]
  });

  require("sdk/widget").Widget({
    'id': "widget-open-settings",
    'label': "Resonance",
    'contentURL': data.url("History.png"),
    'panel': panel,
    'onClick': function() {
      resonanceOptions['domain'] = tabs.activeTab.url.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/)[2];
      return panel.port.emit('initOptions', resonanceOptions);
    }
  });

  panel.port.on('updateOptions', function(opt) {
    resonanceOptions = opt;
    return console.log(opt);
  });

  tabs.on('ready', function(tab) {
    console.log('Tab ready');
    if (resonanceOptions.activated) {
      return console.log('app started');
    }
  });

}).call(this);
